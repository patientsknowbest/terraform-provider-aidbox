version: '3.8'
services:
  database-devbox:
    # :13.2, pinned on 2022-05-31
    image: "healthsamurai/aidboxdb@sha256:df7e461f6010eb9746c9361b7a3b83bea9217ac8fe6597cb88026a5f4f83ad8e"
    ports:
      - "5437:5432"
    environment:
      POSTGRES_USER:     "postgres"
      POSTGRES_PASSWORD: "postgres"
      POSTGRES_DB:       "postgres"

  devbox:
    # :edge, pinned on 2022-05-31
    image: "healthsamurai/devbox@sha256:98e4909e8bb5fd2508bf3c9ed45be629523c381d3d84b3587f3a204f31e3fc2d"
    ports:
      - "8888:8888"
    environment:
      PGHOST: "database-devbox"
      AIDBOX_LICENSE_ID: "${AIDBOX_LICENSE_ID:?err}"
      AIDBOX_LICENSE_KEY: "${AIDBOX_LICENSE_KEY:?err}"
      AIDBOX_CLIENT_ID: "root"
      AIDBOX_CLIENT_SECRET: "secret"
      AIDBOX_ADMIN_ID: "admin"
      AIDBOX_ADMIN_PASSWORD: "secret"
      AIDBOX_PORT: "8888"
      AIDBOX_FHIR_VERSION: "4.0.0"
      PGPORT: "5432"
      PGUSER: "postgres"
      PGPASSWORD: "postgres"
      PGDATABASE: "postgres"

  database-multibox:
    # :13.2, pinned on 2022-05-31
    image: "healthsamurai/aidboxdb@sha256:df7e461f6010eb9746c9361b7a3b83bea9217ac8fe6597cb88026a5f4f83ad8e"
    ports:
      - "5438:5432"
    environment:
      POSTGRES_USER:     "postgres"
      POSTGRES_PASSWORD: "postgres"
      POSTGRES_DB:       "postgres"

  multibox:
    # Version pinned 2022-06-18 tag healthsamurai/multibox:edge
    image: "healthsamurai/multibox@sha256:7bf72b7665e07d3dcf1370bf16cd1e495d98441bc67f81cf46fdb4d30c84576e"
    ports:
      - "8889:8889"
    environment:
      AIDBOX_LICENSE: "${MB_LICENSE:?err}"
      AIDBOX_BASE_URL: "http://box.local:8889"
      AIDBOX_SUPERUSER: "root:secret"
      AIDBOX_CLUSTER_SECRET: "cluster_secret"
      AIDBOX_CLUSTER_DOMAIN: "box.local"
      AIDBOX_PORT: "8889"
      PGHOST: "database-multibox"
      PGPORT: "5432"
      PGUSER: "postgres"
      PGPASSWORD: "postgres"
      PGDATABASE: "postgres"
